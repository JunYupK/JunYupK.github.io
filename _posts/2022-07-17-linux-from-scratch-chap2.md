---
layout: post
title: Linux-From-Scratch Chap2
subtitle: 디스크 파티션 분할 방법
categories : [LFS]
comments: true
---
##Creating a New Partition

LFS를 설치하기 위해서는 파티션 분할이 필요하다고 한다. 나는 지금 wsl2 가상환경을 이용해 Ubuntu를 설치하여 linux 시스템을 사용중인데 디스크 분할이 될 지가 문제였다.

LFS 문서에 따르면 30GB 이상의 파티션이 필요하다고 한다.

거기에 충분한 RAM 사이즈가 확보되어 있지 않으면 추가적인 swap space 도 두면 좋다고 한다

이제 현재 시스템에서 파티션 분할을 해야하는데 여기서는 주로 fdisk 명령이 필요하다.

```

sudo fdisk -l

```

현재 실행중인 모든 파티션을 볼 수 있는 명령어이다.

여기서 /dev/sda , /dev/sdb , /dev/sdc 를 확인 할 수 있는데 a,b,c 순서로 디스크가 지정되는 것이라 보면 된다.

linux partition 에는 종류가 3가지가 있는데

1. Primary Partition: 4개까지 만들수 있다.
2. Extend Partition: 1개까지 만들 수 있다.
3. Logical Partition: 15개만 넘지않는 범위에서 자유롭게 만들어서 사용할 수 있다고 한다.

```

sudo fdisk /dev/sdc

```

명령어를 사용하게 되면 sdc 디스크의 파티션 설정 모드로 들어가는데

여기서 n 을 입력하면 새로운 디스크 파티션을 만드는 모드로 들어갈 수 있으며

p를 입력하면 Primary, 그 후에 파티션 넘버를 지정한 후에

용량을 지정해준 뒤에

p를 입력하면 분할된 파티션을 확인  할 수 있다.

##Creating a File System on the Partition

이제 본격적으로 분할된 파티션에 lfs를 설치하는 부분이다. 빈 파티션을 설정 하였으므로 파일 시스템을 사용할 수 있는데.

여기서 file system의 종류가 ext2, ext3, ext4 가 있으며

ext2는 작은 /boot 와 같이 자주 업데이트되지 않는 작은 파티션에 적합하다.

ext3는 unclean 한 종료 시에 파티션 상태를 복구하는데 도움이 되는 ext2를 업그레이드 한 범용 file system에 사용된다.

ex4는 ext file system의 가장 최신 버전이며 나노초 타임스탬프, 대용량 파일 생성 및 사용, 속도 향상 등 몇가지 새로운 기능을 제공한다.

다른 file system도 많다.

```

mkfs -v -t ext4 /dev/sdc1

```

이 명령어는 아까 분할한 파티션의 sdc1 파티션을 ext4 file system으로 포맷하라 는 명령어이다.

지금 여기서 계속 명령어 오류가 뜨고 포맷이 진행되지 않는 중인데,

자료를 찾아보니 만약 해당 디스크가 사용중이거나 파티션을 나눠도 이미 파일이 있는경우에 꼬여서 포맷이 진행되지 않는경우가 있다고 한다.

아무리 강제 포맷을 진행 해보려고 해도 계속 진행이 되지 않아서 추측을 해보니

지금 나는 윈도우 wsl2 가상머신을 통하여 ubuntu를 사용하여 linux 시스템을 사용중인데 여기서 wsl2 에서는 가상 디스크를 sda, sdb, sdc 3개를 지정을 하였는데

여기서 sda, sdb는 읽기전용이라 파티션 분할이 되지를 않고, sdc 는 1TB 의 가상공간을 제공하지만, wsl2에서 linux가 돌아가는 메인 부팅 디스크가 sdc로 추정이 된다.

그래서 sdc를 파티션 분할을 하고 포맷을 하려고 해도 안돼는건가 싶은데, 여기서 내 컴퓨터의 실제 하드디스크를 가상머신 디스크에 추가하는 과정도 wsl2 에서 제공한다고 하지만, 계속되는 오류로 일단은 여기까지 진행후에 오류를 고쳐서 다시 진행해야 할 것 같다.

##오류 해결...

드디어 오류 해결을 했다.  문제는 왜 해결 됐는지를 모르겠다.

저번에 예상한 문제가 맞기는 맞았다. 아마 ubuntu 환경에서 메인 부팅 디스크가 (VHD)sdc 하나인 것이 문제인 것 같아서, 추가적으로 VHD 를 추가하기 위해

진짜 자료들을 엄청 찾아보고 (attach VHD in WSL2) 별 방법을 다 써봤으나 계속 오류가 떠서 낙담하던 순간에 여러가지 방법 중 무엇떄문인지는 모르겠지만,

가상환경에서 sdd 디스크가 추가 되었고, 거기에 ext4 메인 부팅 디스크가 sdd디스크로 자동적으로 이동이 된 것 같다 (왜지 ... 나중에 추가적으로 알아보자)

그래서 sdc 에 추가적으로 파티션을 분할 한뒤 ex4로 포맷을 진행하니 정상적으로 진행이 되었다!!  chap 3로 넘어갈 차례인거 같다.
